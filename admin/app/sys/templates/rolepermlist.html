{% extends "base_site.html" %}

{% block title %} Table Dynamic {% endblock title %}

{% block stylesheets %}
  {{ super() }}
  
{% endblock stylesheets %}

{% block content %}
  <div class="right_col" role="main" data-panel-id='list-role-perm'>
    <div class="">
      

      <div class="clearfix"></div>
      <div class="row">
            <div class="col-xs-12 col-sm-3">
                <div class="table-header">
                        <h2>角色列表</h2>
                </div>
                <div class="table-bordered">
                    <table id="datatable-role" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                            <th>标识</th>
                            <th>名称</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%for role in roles%}
                            <tr>
                            
                            <td>{{role.id}}</td>
                            <td>{{role.name}}</td>
                            </tr>
                            {%endfor%}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-xs-12 col-sm-9" id="rolePower">
                    
                 <div class="x_title">
                        <h2>权限列表<small></small></h2>
                    <div class="title_right">
                    <div class="col-md-1 col-sm-1 col-xs-12 form-group pull-right top_search">
                        <div class="input-group">
                            &nbsp;
                            <span class="input-group-btn">
                                    <div class="ibox-tools">
                                            <button class="btn  btn-info btn-xs" data-click-name="checked">
                                                <i class=" glyphicon glyphicon-check blue" />
                                                全选
                                            </button>
                                            <button class="btn  btn-info btn-xs " data-click-name="unchecked">
                                                <i class=" glyphicon glyphicon-unchecked blue" />
                                                反选
                                            </button>
                                            <button class="btn  btn-info btn-xs " data-click-name="save">
                                               
                                                保存当前角色权限
                                            </button>
                                        </div>
                                <button class="btn btn-default btn-xs" type="button" data-click-name="create"><i class="fa fa-plus"></i>新增</button>
                            </span>
                            
                        </div>
                    </div>
                    </div>
                <div class="clearfix"></div>
                </div>
                <div class="table-bordered">
                    <table id="simple-table" class="table table-striped table-bordered table-hover">
                        <tbody>
                            {% for group in groups%}
                                <tr>
                                    <th style="color:#16987e">&nbsp;{{group[0]}}</th>
                                </tr>
                                <tr class="">
                                    <td style=" padding-left:20px">
                                        <span class="checkbox checkbox-success checkbox-inline" style="margin:5px 10px 5px 10px">
                                            <input id="@gp-@gr-checkall" name="ZtOnline_checkall" onchange="change_item_states('{{group[0]}}', this)" type="checkbox">
                                            <label for="@gp-@gr-checkall">
                                                全选/取消全选
                                            </label>
                                        </span>
                                        {%for perm in perms%}
                                            
                                            {%if perm.group==group[0] %}
                                            <span class="checkbox checkbox-success checkbox-inline" style="margin:5px 10px 5px 10px">
                                                {%if perm.selected %}
                                                        <input type="checkbox" class="" name="{{group[0]}}-power" id="{{group[0]}}-power-{{perm.id}}" value="{{perm.id}}" checked="checked">
                                                        <label for="{{group[0]}}-power-{{perm.id}}">
                                                            {{perm.name}}
                                                        </label>
                                                {%else%}
                                                    
                                                        <input type="checkbox" class="" name="{{group[0]}}-power" id="{{group[0]}}-power-{{perm.id}}" value="{{perm.id}}">
                                                        <label for="{{group[0]}}-power-{{perm.id}}">
                                                                {{perm.name}}
                                                        </label>
                                                    
                                                {%endif%}
                                            </span>
                                            {%endif%}
                                        {%endfor%}
                
                                    </td>
                                </tr>
                                
                            {%endfor%}
                            </tbody>
                        </table>
                            
                </div>
                
            </div>
           
        </div>
    </div>
  </div>
  
{% endblock content %}

{% block javascripts %}
  {{ super() }}
  <!-- Datatables -->
  <script>
     $(document).ready(function () {
        var $win = $("[data-panel-id='list-role']");
        var $table = $("#datatable-role");

        $win.on("click", "button", function () {
            if ($(this).has("data-click-name")) {
                var clickName = $(this).attr("data-click-name");
                var clickValue = $(this).attr("data-click-value");

                switch(clickName){
                    case "create":
                    case "edit":
                        var url = clickName == "create" ? '/sys/role/edit?id=0' : '/sys/role/edit?id=' + clickValue;
                        $("#dialog-role").ztdialog({
                            'url': url,
                            'title': clickName == "create"?"添加角色": "修改角色",
                            'buttons': 'Save',
                            'height': 450,
                            'width': 650,
                            'fnSaved': function () { $table.DataTable().draw(false); }
                        });
                        break;
                    case "delete":
                        ZTConfirm({
                            "title": "删除",
                            "text": "是否确认删除?",
                            'parms': { id: clickValue },
                            'confirmButtonText': '确定删除',
                            'cancelButtonText': '取消删除',
                            'fnConfirmCallback': function (parms) {
                                var url = '/sys/role/delete?id=' + parms.id;
                                $.post(url, function (rtn) {
                                    var rtnDto = JSON.parse(rtn);
                                    if (rtnDto.result) {
                                        ZTAlert({
                                            'title': '删除成功',
                                            'text': '信息删除成功',
                                            'type': 'success'
                                        });
                                        $table.DataTable().draw(false);
                                    } else {
                                        ZTAlert({
                                            'title': '删除失败',
                                            'text': rtnDto.msg,
                                            'type': 'error'
                                        });
                                    }
                                }, "text");
                            }
                        });
                        break;
                
                }
            }
        });
    
    });

    function change_item_states(groupname, obj) {
        var s = obj.checked;
        $("input[name='" + groupname + "-power']").each(function () {
            this.checked = s;
        });
    }

  </script>
{% endblock javascripts %}
