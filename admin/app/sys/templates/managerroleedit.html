<link href="{{ url_for('static', filename='vendors/ladda/dist/ladda-themeless.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/sweetalert/dist/sweetalert.min.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='vendors/bootstrap-duallistbox/dist/bootstrap-duallistbox.css') }}" rel="stylesheet">

<div class="form-horizontal" autocomplete="off" data-form-id="edit-manager-role" id="edit-manager-role">
        <div class="form-group">
            <div class="col-sm-12">
                {{ form.hidden_tag() }}
                <select multiple="multiple" size="10" name="duallistbox_roles[]" title="duallistbox_roles[]">
                    {% for role in roles %}   
                        {% if role.selected %}
                            <option value="{{role.id}}" selected="selected">{{role.name}}</option>
                        {% else %}
                            <option value="{{role.id}}" >{{role.name}}</option>
                        {% endif%}
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='vendors/select2/dist/js/select2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='build/js/Zt.Common.min.js') }}"></script>
    <script src="{{ url_for('static', filename='build/js/Zt.SweetAlert.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendors/ladda/dist/spin.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendors/ladda/dist/ladda.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendors/ladda/dist/ladda.jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendors/sweetalert/dist/sweetalert.min.js') }}"></script>
    <script src="{{ url_for('static', filename='vendors/bootstrap-duallistbox/dist/jquery.bootstrap-duallistbox.js') }}"></script>
    <script>
    $(document).ready(function () {
        var demo1 = $('select[name="duallistbox_roles[]"]').bootstrapDualListbox({"selectorMinimalHeight":"400"});
        var $win = getSubWinBody('edit-manager-role');
        var winEvents = $win.data("winEvents");
        var winButtons = $win.data("buttons");

        winButtons.save.click = function () {
            $('.ladda-button-save').attr("data-style", "expand-left")
            var l = $('.ladda-button-save').ladda();
            ids=$('[name="duallistbox_roles[]"]').val();
            var subData = {
                id: $("#txt_id").val(),
                roleids:""+ids+"",
                csrf_token:$("#csrf_token").val(),
            };
            var url = '/sys/managerrole/save';
            l.ladda('start');
            $.post(url, subData, function (rtn) {
                var rtnDto = JSON.parse(rtn);
                console.log(!rtnDto.valid);
                if (!rtnDto.valid) {
                    var msg = "";
                    for (var i in rtnDto.msg) {
                        msg = msg + rtnDto.msg[i] + ";";
                    }
                    ZTAlert({
                        "title": "验证失败",
                        "text": msg
                    });
                    l.ladda('stop');
                } else if (rtnDto.result) {
                    winEvents.SavedAndClose();
                } else {
                    ZTAlert({
                        "title": "保存失败",
                        "text": rtnDto.msg
                    });
                    l.ladda('stop');
                }

                //通知modal window Save状况
                //return rtnValue;
            }, "text");
        }
    });
    </script>